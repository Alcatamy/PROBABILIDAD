<!DOCTYPE html>
<html lang="es">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Aprende Probabilidad Avanzado (Versión Completa con Exámenes)</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <script>
       MathJax = {
         tex: {
           inlineMath: [['$', '$'], ['\\(', '\\)']],
           displayMath: [['$$', '$$'], ['\\[', '\\]']],
           processEscapes: true
         },
         svg: {
           fontCache: 'global'
         }
       };
   </script>
   <script type="text/javascript" id="MathJax-script" async
       src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
   </script>
   <style>
       body {
           font-family: 'Inter', sans-serif;
           background-color: #f0f9ff; /* Fondo azul claro */
           color: #334155; /* Gris pizarra 700 */
       }
       .concept-card, .exam-section {
           background-color: white;
           border-radius: 0.75rem; /* 12px */
           box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
           padding: 1.5rem; /* 24px */
           margin-bottom: 2rem; /* 32px */
       }
       .concept-card:hover {
           transform: translateY(-5px);
       }
       .exercise, .exam-question-item {
           background-color: #f1f5f9; /* Gris pizarra 100 */
           border: 1px solid #cbd5e1; /* Gris pizarra 300 */
           border-radius: 0.5rem; /* 8px */
           padding: 1.25rem; /* 20px */
           margin-top: 1.5rem; /* 24px */
       }
       .feedback, .question-feedback {
           margin-top: 0.75rem; /* 12px */
           padding: 0.75rem; /* 12px */
           border-radius: 0.375rem; /* 6px */
           font-weight: 600;
       }
       .feedback.correct, .question-feedback.correct {
           background-color: #ecfdf5; /* Verde 50 */
           color: #059669; /* Verde 600 */
           border-left: 4px solid #10b981; /* Verde 500 */
       }
       .feedback.incorrect, .question-feedback.incorrect {
           background-color: #fff1f2; /* Rosa 50 */
           color: #e11d48; /* Rosa 600 */
           border-left: 4px solid #f43f5e; /* Rosa 500 */
       }
       .feedback.hint {
           background-color: #fffbeb; /* Ámbar 50 */
           color: #d97706; /* Ámbar 600 */
           border-left: 4px solid #f59e0b; /* Ámbar 500 */
       }
       .btn {
           padding: 0.625rem 1.25rem; /* 10px 20px */
           border-radius: 0.375rem; /* 6px */
           font-weight: 600;
           cursor: pointer;
           transition: background-color 0.2s ease, transform 0.1s ease;
           display: inline-flex;
           align-items: center;
       }
       .btn:hover {
           transform: translateY(-1px);
       }
       .btn i {
           margin-right: 0.5rem;
       }
       .btn-primary {
           background-color: #6366f1; /* Índigo 500 */
           color: white;
       }
       .btn-primary:hover {
           background-color: #4f46e5; /* Índigo 600 */
       }
        .btn-secondary {
           background-color: #10b981; /* Verde 500 */
           color: white;
       }
       .btn-secondary:hover {
           background-color: #059669; /* Verde 600 */
       }
       .input-field, .exam-input {
           border: 1px solid #94a3b8; /* Gris pizarra 400 */
           border-radius: 0.375rem; /* 6px */
           padding: 0.625rem; /* 10px */
           width: 100%;
           transition: border-color 0.2s ease, box-shadow 0.2s ease;
       }
       .input-field:focus, .exam-input:focus {
           border-color: #6366f1; /* Índigo 500 */
           box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
           outline: none;
       }
       h1, h2, h3 {
           color: #4338ca; /* Índigo 700 */
       }
       h1 {
           font-size: 2.5rem; /* 40px */
           font-weight: 800;
            border-bottom: 3px solid #818cf8; /* Índigo 400 */
           padding-bottom: 0.75rem;
       }
       h2 {
           font-size: 1.875rem; /* 30px */
           font-weight: 700;
           margin-bottom: 1.25rem; /* 20px */
           padding-bottom: 0.5rem; /* 8px */
           border-bottom: 2px solid #a5b4fc; /* Índigo 300 */
       }
       h3 {
           font-size: 1.25rem; /* 20px */
           font-weight: 600;
           color: #4f46e5; /* Índigo 600 */
           margin-top: 1.5rem; /* 24px */
           margin-bottom: 0.75rem; /* 12px */
       }
       .accordion-item {
           border: 1px solid #e2e8f0; /* Gris pizarra 200 */
           border-radius: 0.5rem;
           margin-bottom: 0.5rem;
           overflow: hidden;
       }
       .accordion-header {
           cursor: pointer;
           padding: 1rem 1.25rem; /* 16px 20px */
           background-color: #eef2ff; /* Índigo 50 */
           display: flex;
           justify-content: space-between;
           align-items: center;
           font-weight: 600;
           color: #4f46e5; /* Índigo 600 */
       }
       .accordion-header:hover {
           background-color: #e0e7ff; /* Índigo 100 */
       }
       .accordion-content {
           padding: 1.25rem; /* 20px */
           background-color: #f8fafc; /* Gris pizarra 50 */
           display: none;
           border-top: 1px solid #e2e8f0; /* Gris pizarra 200 */
       }
       .accordion-icon {
           transition: transform 0.3s ease;
       }
       .accordion-header.active .accordion-icon {
           transform: rotate(180deg);
       }
       .example {
           background-color: #f0fdf4; /* Verde 50 */
           border-left: 4px solid #22c55e; /* Verde 500 */
           padding: 1rem;
           margin: 1rem 0;
           border-radius: 0.25rem;
       }
       .venn-diagram {
           display: flex;
           justify-content: center;
           align-items: center;
           margin: 1.5rem 0;
       }
       .venn-diagram svg {
           max-width: 300px;
           height: auto;
       }
       .tree-diagram { 
           margin: 1.5rem 0;
           padding: 1rem;
           border: 1px dashed #94a3b8; /* Gris pizarra 400 */
           border-radius: 0.5rem;
           background-color: #f8fafc; /* Gris pizarra 50 */
           font-size: 0.9em;
       }
       .tree-node {
           margin-left: 20px;
           padding-left: 15px;
           border-left: 1px solid #cbd5e1; /* Gris pizarra 300 */
           position: relative;
           padding-top: 5px;
           padding-bottom: 5px;
       }
       .tree-node::before { 
           content: '';
           position: absolute;
           top: 15px; 
           left: 0;
           width: 15px;
           height: 1px;
           background-color: #cbd5e1; /* Gris pizarra 300 */
       }
       .tree-node:last-child {
            border-left: 1px solid #cbd5e1; /* Gris pizarra 300 */
       }
        .tree-branch-label {
           display: inline-block;
           margin-bottom: 0.25rem;
           font-weight: 500;
       }
       .tree-path-prob {
           font-style: italic;
           color: #5b21b6; /* Violeta 700 */
           font-size: 0.9em;
       }
       .exam-results-summary {
           padding: 1.5rem;
           background-color: #eef2ff; /* Índigo 50 */
           border: 2px solid #818cf8; /* Índigo 400 */
           border-radius: 0.5rem;
           margin-top: 2rem;
           text-align: center;
       }
       .exam-results-summary h3 {
           color: #4f46e5; /* Índigo 600 */
       }
   </style>
</head>
<body class="p-4 md:p-8">
   <div class="container mx-auto max-w-5xl">
       <header class="text-center mb-12">
           <h1 class="text-4xl md:text-5xl"><i class="fas fa-dice-d20 mr-3 text-indigo-500"></i>Probabilidad Total: Domina el Azar</h1>
           <p class="text-lg text-slate-600 mt-3">Una guía interactiva completa desde lo básico hasta conceptos avanzados y exámenes de práctica.</p>
       </header>

       <nav class="mb-8 p-4 bg-white rounded-lg shadow-md">
           <h3 class="text-lg font-semibold mb-2 text-indigo-600">Navegación Rápida:</h3>
           <ul class="flex flex-wrap gap-2">
               <li><a href="#conceptos-basicos" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-lightbulb"></i>Básicos</a></li>
               <li><a href="#tipos-sucesos" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-tags"></i>Tipos Sucesos</a></li>
               <li><a href="#operaciones-sucesos" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-calculator"></i>Operaciones</a></li>
               <li><a href="#leyes-morgan" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-project-diagram"></i>Leyes de Morgan</a></li>
               <li><a href="#regla-laplace" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-ruler-combined"></i>Regla de Laplace</a></li>
               <li><a href="#probabilidad-condicionada" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-question-circle"></i>P. Condicionada</a></li>
               <li><a href="#sucesos-independientes-dependientes" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-link"></i>Independencia</a></li>
               <li><a href="#diagramas-arbol" class="btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm"><i class="fas fa-sitemap"></i>Diagramas Árbol</a></li>
               <li><a href="#glosario" class="btn bg-teal-100 text-teal-700 hover:bg-teal-200 text-sm"><i class="fas fa-book"></i>Glosario</a></li>
               <li><a href="#seccion-examen" class="btn bg-amber-400 text-amber-800 hover:bg-amber-500 text-sm font-bold"><i class="fas fa-pencil-alt"></i>EXAMEN DE PRÁCTICA</a></li>
           </ul>
       </nav>

       <section id="conceptos-basicos" class="concept-card"><h2><i class="fas fa-lightbulb mr-2"></i>1. Conceptos Básicos de Probabilidad</h2></section>
       <section id="tipos-sucesos" class="concept-card"><h2><i class="fas fa-tags mr-2"></i>2. Tipos de Sucesos Especiales</h2></section>
       <section id="operaciones-sucesos" class="concept-card"><h2><i class="fas fa-calculator mr-2"></i>3. Operaciones con Sucesos</h2></section>
       <section id="leyes-morgan" class="concept-card"><h2><i class="fas fa-project-diagram mr-2"></i>4. Leyes de Morgan</h2></section>
       <section id="regla-laplace" class="concept-card"><h2><i class="fas fa-ruler-combined mr-2"></i>5. Regla de Laplace</h2></section>
       <section id="probabilidad-condicionada" class="concept-card"><h2><i class="fas fa-question-circle mr-2"></i>6. Probabilidad Condicionada</h2></section>
       <section id="sucesos-independientes-dependientes" class="concept-card"><h2><i class="fas fa-link mr-2"></i>7. Sucesos Independientes y Dependientes</h2></section>
       <section id="diagramas-arbol" class="concept-card"><h2><i class="fas fa-sitemap mr-2"></i>8. Diagramas de Árbol</h2></section>
       <section id="glosario" class="concept-card"><h2><i class="fas fa-book mr-2"></i>9. Glosario de Términos</h2></section>
       
       <section id="seccion-examen" class="exam-section">
           <h2 class="text-emerald-700"><i class="fas fa-pencil-alt mr-2"></i>📝 Examen de Práctica Interactiva</h2>
           <p class="mb-4 text-slate-600">Pon a prueba tus conocimientos con un examen de 10 preguntas seleccionadas aleatoriamente de nuestro banco de ejercicios. ¡Puedes generar un nuevo examen tantas veces como quieras!</p>
           
           <button id="startExamButton" onclick="startNewExam()" class="btn btn-secondary mb-6"><i class="fas fa-play"></i>Generar Nuevo Examen de Práctica</button>
           
           <div id="examContainer" class="hidden">
               </div>
           
           <button id="submitExamButton" onclick="submitExam()" class="btn btn-primary mt-6 hidden"><i class="fas fa-check-double"></i>Finalizar y Calificar Examen</button>
           
           <div id="examResults" class="hidden mt-8">
               </div>
       </section>


       <footer class="text-center mt-16 py-8 border-t border-slate-300">
           <p class="text-slate-600 text-lg">¡Felicidades por llegar hasta aquí! La probabilidad es una herramienta poderosa.</p>
           <p class="text-sm text-slate-500 mt-2">© 2024 Aprende Probabilidad Avanzado - Contenido generado para fines educativos.</p>
       </footer>
   </div>

<script>
   // BANCO DE PREGUNTAS
   const questionBank = [
       // Preguntas de conceptos básicos y tipos de sucesos
       {
           id: 'qb_c1',
           text: 'Lanzar una moneda y observar si cae cara o cruz es un ejemplo de:',
           type: 'multiple_choice',
           topic: 'Conceptos Básicos',
           difficulty: 'fácil',
           options: [
               { text: 'Experimento determinista', value: 'determinista' },
               { text: 'Experimento aleatorio', value: 'aleatorio' },
               { text: 'Suceso seguro', value: 'seguro' },
               { text: 'Suceso imposible', value: 'imposible' }
           ],
           correctAnswer: 'aleatorio',
           explanation: 'Un experimento aleatorio es aquel cuyo resultado no se puede predecir con certeza, como el lanzamiento de una moneda.'
       },
       {
           id: 'qb_c2',
           text: 'En el lanzamiento de un dado de 6 caras, el suceso "obtener un 7" es un:',
           type: 'multiple_choice',
           topic: 'Tipos de Sucesos',
           difficulty: 'fácil',
           options: [
               { text: 'Suceso elemental', value: 'elemental' },
               { text: 'Suceso compuesto', value: 'compuesto' },
               { text: 'Suceso seguro', value: 'seguro' },
               { text: 'Suceso imposible', value: 'imposible' }
           ],
           correctAnswer: 'imposible',
           explanation: 'Es imposible obtener un 7 al lanzar un dado de 6 caras, ya que los resultados posibles son \\({1, 2, 3, 4, 5, 6}\\).'
       },
       {
           id: 'qb_c3',
           text: 'Si \\(A\\) es el suceso "sacar un número par" al lanzar un dado de 6 caras, ¿cuál es su suceso contrario \\(\\overline{A}\\)? (Escribe los elementos del conjunto, ej: {1,3,5})',
           type: 'short_answer_text', // Se valida como texto, pero la explicación usa MathJax
           topic: 'Tipos de Sucesos',
           difficulty: 'fácil',
           correctAnswer: '{1,3,5}', 
           explanation: 'Si \\(A = \\{2, 4, 6\\}\\), entonces \\(\\overline{A}\\) (no sacar par) es "sacar impar", que corresponde a los elementos \\(\\{1, 3, 5\\}\\).'
       },
       // Preguntas de Operaciones y Leyes de Morgan
       {
           id: 'qb_op1',
           text: 'Si \\(A = \\{1, 2, 3\\}\\) y \\(B = \\{3, 4, 5\\}\\), ¿cuál es \\(A \\cup B\\)? (Escribe los elementos del conjunto, ej: {1,2,3,4,5})',
           type: 'short_answer_set',
           topic: 'Operaciones',
           difficulty: 'fácil',
           correctAnswer: '{1,2,3,4,5}',
           explanation: '\\(A \\cup B\\) contiene todos los elementos que están en A, en B, o en ambos: \\(\\{1, 2, 3, 4, 5\\}\\).'
       },
       {
           id: 'qb_op2',
           text: 'Si \\(A = \\{a, b, c, d\\}\\) y \\(B = \\{c, d, e, f\\}\\), ¿cuál es \\(A \\cap B\\)? (Escribe los elementos del conjunto, ej: {c,d})',
           type: 'short_answer_set',
           topic: 'Operaciones',
           difficulty: 'fácil',
           correctAnswer: '{c,d}',
           explanation: '\\(A \\cap B\\) contiene los elementos comunes a A y B: \\(\\{c, d\\}\\).'
       },
       {
           id: 'qb_m1',
           text: 'Según las Leyes de Morgan, \\(\\overline{A \\cap B}\\) es equivalente a:',
           type: 'multiple_choice_math',
           topic: 'Leyes de Morgan',
           difficulty: 'media',
           options: [
               { text: '\\(\\overline{A} \\cap \\overline{B}\\)', value: 'op1' },
               { text: '\\(\\overline{A} \\cup \\overline{B}\\)', value: 'op2' },
               { text: '\\(A \\cup B\\)', value: 'op3' },
               { text: '\\(A \\cap B\\)', value: 'op4' }
           ],
           correctAnswer: 'op2',
           explanation: 'Una de las Leyes de Morgan establece que \\(\\overline{A \\cap B} = \\overline{A} \\cup \\overline{B}\\).'
       },
       // Preguntas de Regla de Laplace
       {
           id: 'qb_lp1',
           text: 'Se lanza un dado justo de 6 caras. ¿Cuál es la probabilidad de obtener un número mayor que 4? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Regla de Laplace',
           difficulty: 'fácil',
           correctAnswer: { fraction: "1/3", decimal: 0.333 }, 
           explanation: 'Los números mayores que 4 son 5 y 6 (2 casos favorables). Hay 6 casos posibles. \\(P = 2/6 = 1/3\\).'
       },
       {
           id: 'qb_lp2',
           text: 'En una urna hay 5 bolas rojas, 3 azules y 2 verdes. Si se extrae una bola al azar, ¿cuál es la probabilidad de que NO sea azul? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Regla de Laplace',
           difficulty: 'media',
           correctAnswer: { fraction: "7/10", decimal: 0.7 }, 
           explanation: 'Hay 10 bolas en total. Las bolas que no son azules son 5 rojas + 2 verdes = 7 bolas. \\(P(\\text{no azul}) = 7/10\\).'
       },
       {
           id: 'qb_lp3',
           text: 'Se lanzan dos monedas. ¿Cuál es la probabilidad de obtener al menos una cara? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Regla de Laplace',
           difficulty: 'media',
           correctAnswer: { fraction: "3/4", decimal: 0.75 }, 
           explanation: 'El espacio muestral es \\(\\{CC, CX, XC, XX\\}\\) (4 casos). Los casos con al menos una cara son \\(\\{CC, CX, XC\\}\\) (3 casos). \\(P = 3/4\\). Alternativamente, \\(P(\\text{al menos una cara}) = 1 - P(\\text{ninguna cara}) = 1 - P(XX) = 1 - 1/4 = 3/4\\).'
       },
       // Preguntas de Probabilidad Condicionada
       {
           id: 'qb_pc1',
           text: 'Si \\(P(A) = 0.5\\), \\(P(B) = 0.4\\) y \\(P(A \\cap B) = 0.2\\), calcula \\(P(A|B)\\). (Decimal)',
           type: 'decimal',
           topic: 'Probabilidad Condicionada',
           difficulty: 'media',
           correctAnswer: { decimal: 0.5 }, 
           explanation: '\\(P(A|B) = P(A \\cap B) / P(B) = 0.2 / 0.4 = 0.5\\).'
       },
       {
           id: 'qb_pc2',
           text: 'En una clase, el 60% de los estudiantes son chicas. El 30% de las chicas y el 20% de los chicos llevan gafas. Si se elige un estudiante al azar y lleva gafas, ¿cuál es la probabilidad de que sea chica? (Redondea a 2 decimales si es necesario).',
           type: 'decimal_range', 
           topic: 'Probabilidad Condicionada',
           difficulty: 'difícil',
           correctAnswer: { min: 0.68, max: 0.70 },
           explanation: 'Sea C="Chica", O="Chico", G="Lleva Gafas". \\(P(C)=0.6, P(O)=0.4, P(G|C)=0.3, P(G|O)=0.2\\). Buscamos \\(P(C|G)\\). <br> \\(P(C|G) = \\frac{P(G|C)P(C)}{P(G|C)P(C) + P(G|O)P(O)} = \\frac{0.3 \\cdot 0.6}{0.3 \\cdot 0.6 + 0.2 \\cdot 0.4} = \\frac{0.18}{0.18 + 0.08} = \\frac{0.18}{0.26} \\approx 0.69\\).'
       },
       // Preguntas de Independencia de Sucesos
       {
           id: 'qb_ind1',
           text: 'Se extraen dos cartas de una baraja española (40 cartas) CON reemplazamiento. Sea A = "la primera carta es un rey" y B = "la segunda carta es un rey". ¿Son A y B sucesos independientes?',
           type: 'true_false',
           topic: 'Independencia',
           difficulty: 'media',
           options: [ {text: 'Sí, son independientes', value: true}, {text: 'No, son dependientes', value: false} ],
           correctAnswer: true,
           explanation: 'Con reemplazamiento, la probabilidad de sacar un rey en la segunda extracción no se ve afectada por la primera. \\(P(B|A) = P(B)\\).'
       },
       {
           id: 'qb_ind2',
           text: 'Si \\(P(A) = 0.5\\), \\(P(B) = 0.6\\) y los sucesos A y B son independientes, ¿cuál es \\(P(A \\cap B)\\)? (Decimal)',
           type: 'decimal',
           topic: 'Independencia',
           difficulty: 'fácil',
           correctAnswer: { decimal: 0.3 }, 
           explanation: 'Si A y B son independientes, \\(P(A \\cap B) = P(A) \\cdot P(B) = 0.5 \\cdot 0.6 = 0.3\\).'
       },
       // Preguntas Variadas / Combinadas
       {
           id: 'qb_v1',
           text: 'La probabilidad de que un estudiante apruebe Matemáticas es 0.7, y la de que apruebe Física es 0.6. Si la probabilidad de que apruebe ambas es 0.45, ¿cuál es la probabilidad de que apruebe al menos una de las dos asignaturas? (Decimal)',
           type: 'decimal',
           topic: 'Operaciones',
           difficulty: 'media',
           correctAnswer: { decimal: 0.85 }, 
           explanation: 'Sea M="Aprueba Matemáticas", F="Aprueba Física". Buscamos \\(P(M \\cup F)\\). <br> \\(P(M \\cup F) = P(M) + P(F) - P(M \\cap F) = 0.7 + 0.6 - 0.45 = 0.85\\).'
       },
       {
           id: 'qb_v2',
           text: 'Un dado está trucado de forma que la probabilidad de sacar un 6 es 0.5, y las probabilidades de sacar cualquier otro número (1, 2, 3, 4, 5) son iguales entre sí. ¿Cuál es la probabilidad de sacar un 1? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Probabilidad Axiomática',
           difficulty: 'difícil',
           correctAnswer: { fraction: "1/10", decimal: 0.1 },
           explanation: 'Sea \\(P(6)=0.5\\). La suma de todas las probabilidades debe ser 1. Entonces \\(P(1)+P(2)+P(3)+P(4)+P(5) = 1 - P(6) = 1 - 0.5 = 0.5\\). Como \\(P(1)=P(2)=P(3)=P(4)=P(5)=x\\), tenemos \\(5x = 0.5\\), por lo que \\(x = 0.5 / 5 = 0.1\\). Así, \\(P(1) = 0.1\\).'
       },
       {
           id: 'qb_lp4',
           text: 'En una clase de 30 alumnos, 18 son chicas. ¿Cuál es la probabilidad de que al elegir un alumno al azar sea chico? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Regla de Laplace',
           difficulty: 'fácil',
           correctAnswer: { fraction: "2/5", decimal: 0.4 }, 
           explanation: 'Si hay 18 chicas en una clase de 30 alumnos, hay \\(30 - 18 = 12\\) chicos. La probabilidad de elegir un chico es \\(12/30 = 2/5 = 0.4\\).'
       },
       {
           id: 'qb_op3',
           text: 'Si \\(E\\) es el espacio muestral, ¿a qué es igual \\(A \\cup \\overline{A}\\)? (Escribe la letra o el nombre)',
           type: 'short_answer_text',
           topic: 'Operaciones',
           difficulty: 'fácil',
           correctAnswer: 'E', 
           explanation: 'La unión de un suceso con su contrario siempre es el espacio muestral completo \\(E\\) (el suceso seguro).'
       },
        {
           id: 'qb_pc3',
           text: 'Se lanzan dos dados. Sabiendo que la suma de los puntos es 7, ¿cuál es la probabilidad de que en uno de los dados haya salido un 3? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Probabilidad Condicionada',
           difficulty: 'media',
           correctAnswer: { fraction: "1/3", decimal: 0.333 },
           explanation: 'Los pares que suman 7 son: (1,6), (2,5), (3,4), (4,3), (5,2), (6,1) (6 casos). De estos, los que contienen un 3 son (3,4) y (4,3) (2 casos). La probabilidad es \\(2/6 = 1/3\\).'
       },
       {
           id: 'qb_ind3',
           text: 'Verdadero o Falso: Si dos sucesos son independientes, entonces son incompatibles.',
           type: 'true_false',
           topic: 'Independencia',
           difficulty: 'media',
           options: [ {text: 'Verdadero', value: true}, {text: 'Falso', value: false} ],
           correctAnswer: false,
           explanation: 'Falso. Por ejemplo, al lanzar dos monedas, "cara en la primera" y "cara en la segunda" son independientes, pero no incompatibles (puede ocurrir CC). De hecho, si A y B son independientes y P(A)>0, P(B)>0, entonces P(A \\(\\cap\\) B) = P(A)P(B) > 0, por lo que no pueden ser incompatibles (ya que para incompatibles P(A \\(\\cap\\) B) = 0).'
       },
       {
           id: 'qb_v3',
           text: 'Una bolsa contiene 4 canicas rojas y 6 azules. Se extraen dos canicas SIN reemplazamiento. ¿Cuál es la probabilidad de que ambas sean rojas? (Fracción o decimal)',
           type: 'fraction_decimal',
           topic: 'Diagramas Árbol / Condicionada',
           difficulty: 'media',
           correctAnswer: { fraction: "2/15", decimal: 0.133 },
           explanation: 'La probabilidad de que la primera sea roja es \\(4/10\\). Dado que la primera fue roja, quedan 3 rojas y 9 en total. La probabilidad de que la segunda sea roja es \\(3/9\\). Entonces, \\(P(\\text{ambas rojas}) = (4/10) \\cdot (3/9) = 12/90 = 2/15\\).'
       }
   ];

   let currentExamQuestions = [];
   let userAnswers = {};

   // Contenido HTML completo para las secciones teóricas
   const teoriaContenido = {
       "conceptos-basicos": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-atom mr-2"></i>Experimento Aleatorio y Determinista</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>Un <strong>experimento aleatorio</strong> es aquel cuyo resultado no se puede predecir con certeza, aunque se conozcan todos los resultados posibles. Depende del azar. Ejemplo: lanzar un dado <i class="fas fa-dice-three"></i>.</p>
                   <p class="mt-2">Un <strong>experimento determinista</strong> es aquel en el que se puede predecir el resultado si se repite en las mismas condiciones, ya que no depende del azar. Ejemplo: calentar agua a 100°C <i class="fas fa-temperature-high"></i> (siempre hierve a esa temperatura a presión normal).</p>
                   <div class="exercise">
                       <h3>Ejercicio 1.1 (Teoría): Identifica el tipo de experimento</h3>
                       <p class="mb-2">"Dejar caer una piedra desde una ventana". ¿Es aleatorio o determinista?</p>
                       <select id="ex_teo_1_1_tipo" class="input-field mb-2">
                           <option value="">Selecciona una opción</option>
                           <option value="determinista">Determinista</option>
                           <option value="aleatorio">Aleatorio</option>
                       </select>
                       <button onclick="checkExTeo1_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_1_1" class="feedback"></div>
                   </div>
               </div>
           </div>
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-shapes mr-2"></i>Espacio Muestral (\\(E\\)) y Sucesos</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>El <strong>espacio muestral (\\(E\\))</strong> es el conjunto de todos los resultados posibles de un experimento aleatorio. Se representa con la letra \\(E\\). Ejemplo: Al lanzar una moneda, \\(E = \\{Cara, Cruz\\}\\).</p>
                   <p class="mt-2">Un <strong>suceso</strong> es cualquier subconjunto del espacio muestral. Se suelen denotar con letras mayúsculas (\\(A, B, \\dots\\)).</p>
                   <ul class="list-disc list-inside mt-2 pl-4">
                       <li><strong>Suceso Elemental:</strong> Formado por un único resultado. Ej: \\(A = \\text{"sacar un 3"}\\) al lanzar un dado.</li>
                       <li><strong>Suceso Compuesto:</strong> Formado por varios resultados. Ej: \\(B = \\text{"sacar par"} = \\{2, 4, 6\\}\\).</li>
                   </ul>
                   <div class="example">
                       <p><strong>Ejemplo resuelto:</strong> Lanzamos un dado de 4 caras (tetraedro) numerado del 1 al 4.</p>
                       <p>Espacio Muestral \\(E = \\{1, 2, 3, 4\\}\\).</p>
                       <p>Suceso \\(A = \\text{"Obtener un número par"} = \\{2, 4\\}\\) (Compuesto).</p>
                       <p>Suceso \\(B = \\text{"Obtener un 1"} = \\{1\\}\\) (Elemental).</p>
                   </div>
                   <div class="exercise">
                       <h3>Ejercicio 1.2 (Teoría): Espacio Muestral</h3>
                       <p class="mb-2">Si lanzamos un dado de 6 caras, ¿cuál es el espacio muestral? Escribe los elementos separados por comas (ej: 1,2,3).</p>
                       <input type="text" id="ex_teo_1_2_espacio" class="input-field mb-2" placeholder="Ej: a,b,c">
                       <button onclick="checkExTeo1_2()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_1_2" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "tipos-sucesos": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-ban mr-2"></i>Imposible (\\(\\emptyset\\)), <i class="fas fa-shield-alt mr-2"></i>Seguro (\\(E\\)), <i class="fas fa-yin-yang mr-2"></i>Contrario (\\(\\overline{A}\\))</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <ul class="list-disc list-inside pl-4 space-y-2">
                       <li><strong>Suceso Imposible (\\(\\emptyset\\)):</strong> Nunca ocurre. \\(P(\\emptyset) = 0\\). Ej: "Sacar un 7" en un dado de 6 caras.</li>
                       <li><strong>Suceso Seguro (\\(E\\)):</strong> Ocurre siempre. \\(P(E) = 1\\). Ej: "Sacar un número \\(< 7\\)" en un dado de 6 caras.</li>
                       <li><strong>Suceso Contrario (\\(\\overline{A}\\) o \\(A^c\\)):</strong> Ocurre cuando NO ocurre \\(A\\). \\(P(\\overline{A}) = 1 - P(A)\\). Ej: Si \\(A = \\text{"sacar par"}\\), \\(\\overline{A} = \\text{"sacar impar"}\\).</li>
                   </ul>
                   <div class="exercise">
                       <h3>Ejercicio 2.1 (Teoría): Suceso Contrario</h3>
                       <p class="mb-2">En el experimento de lanzar un dado de 6 caras, si el suceso \\(A = \\text{"sacar un número menor o igual a 2"}\\) (es decir, \\(A = \\{1, 2\\}\\)), ¿cuál es el suceso contrario \\(\\overline{A}\\)? Escribe los elementos separados por comas.</p>
                       <input type="text" id="ex_teo_2_1_contrario" class="input-field mb-2" placeholder="Ej: a,b,c">
                       <button onclick="checkExTeo2_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_2_1" class="feedback"></div>
                   </div>
               </div>
           </div>
            <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-handshake-slash mr-2"></i>Compatibles e <i class="fas fa-people-arrows mr-2"></i>Incompatibles</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <ul class="list-disc list-inside pl-4 space-y-2">
                       <li><strong>Sucesos Incompatibles (o mutuamente excluyentes):</strong> No pueden ocurrir a la vez. Su intersección es vacía (\\(A \\cap B = \\emptyset\\)). Ej: "Sacar par" y "sacar un 5" en un dado.</li>
                       <li><strong>Sucesos Compatibles:</strong> Pueden ocurrir a la vez (\\(A \\cap B \\neq \\emptyset\\)). Ej: "Sacar par" y "sacar \\(> 3\\)" (el 4 y el 6 cumplen ambos).</li>
                   </ul>
                    <div class="exercise">
                       <h3>Ejercicio 2.2 (Teoría): Compatibilidad</h3>
                       <p class="mb-2">Al lanzar un dado de 6 caras, considera los sucesos: <br>\\(A = \\text{"sacar un número primo"}\\) ( \\(\\{2, 3, 5\\}\\} ) <br>\\(B = \\text{"sacar un número par"}\\) ( \\(\\{2, 4, 6\\}\\} ). <br>¿Son \\(A\\) y \\(B\\) compatibles o incompatibles?</p>
                       <select id="ex_teo_2_2_compatibilidad" class="input-field mb-2">
                           <option value="">Selecciona una opción</option>
                           <option value="compatibles">Compatibles</option>
                           <option value="incompatibles">Incompatibles</option>
                       </select>
                       <button onclick="checkExTeo2_2()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_2_2" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "operaciones-sucesos": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-union mr-2"></i>Unión (\\(A \\cup B\\)) e <i class="fas fa-intersection mr-2"></i>Intersección (\\(A \\cap B\\))</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p><strong>Unión (\\(A \\cup B\\)):</strong> Suceso formado por los elementos de \\(A\\), o de \\(B\\), o de ambos. Se lee "\\(A\\) o \\(B\\)".</p>
                   <p class="mt-1"><strong>Intersección (\\(A \\cap B\\)):</strong> Suceso formado por los elementos comunes a \\(A\\) y \\(B\\). Se lee "\\(A\\) y \\(B\\)".</p>
                   <div class="venn-diagram">
                       <svg viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                           <title>Diagrama de Venn para Unión e Intersección</title>
                           <rect x="0" y="0" width="200" height="120" fill="#f0f9ff" stroke="#94a3b8" stroke-width="1"/>
                           <text x="5" y="15" font-size="10" fill="#334155">E</text>
                           <circle cx="75" cy="60" r="40" fill="#a5b4fc" fill-opacity="0.5" stroke="#6366f1" stroke-width="1.5"/>
                           <text x="70" y="65" font-size="12" fill="#1e1b4b">A</text>
                           <circle cx="125" cy="60" r="40" fill="#818cf8" fill-opacity="0.5" stroke="#4f46e5" stroke-width="1.5"/>
                           <text x="120" y="65" font-size="12" fill="#1e1b4b">B</text>
                           <path d="M100,32.11A40,40 0 0 0 100,87.88A40,40 0 0 0 100,32.11Z" fill="#6366f1" fill-opacity="0.7"/>
                           <text x="92" y="65" font-size="10" fill="white">A\\(\\cap\\)B</text>
                           <text x="40" y="30" font-size="9" fill="#334155">A \\(\\cup\\) B (todo lo coloreado)</text>
                       </svg>
                   </div>
                   <p class="text-sm text-center text-slate-500">Visualización de \\(A \\cup B\\) (toda el área de ambos círculos) y \\(A \\cap B\\) (la superposición).</p>
                   <div class="example">
                       <p><strong>Ejemplo resuelto:</strong> En un dado de 6 caras, \\(A=\\text{"sacar par"}=\\{2,4,6\\}\\), \\(B=\\text{"sacar múltiplo de 3"}=\\{3,6\\}\\).</p>
                       <p>\\(A \\cup B = \\{2, 3, 4, 6\\}\\)</p>
                       <p>\\(A \\cap B = \\{6\\}\\)</p>
                   </div>
                   <div class="exercise">
                       <h3>Ejercicio 3.1 (Teoría): Unión de Sucesos</h3>
                       <p class="mb-2">Al lanzar un dado, \\(A = \\text{"sacar un número menor que 3"}\\) (\\(\\{1, 2\\}\\)) y \\(B = \\text{"sacar un número par"}\\) (\\(\\{2, 4, 6\\}\\)). ¿Cuál es \\(A \\cup B\\)? Escribe los elementos separados por comas.</p>
                       <input type="text" id="ex_teo_3_1_union" class="input-field mb-2" placeholder="Ej: 1,2,3">
                       <button onclick="checkExTeo3_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_3_1" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "leyes-morgan": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-equals mr-2"></i>Formulaciones y Significado</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>Las Leyes de Morgan son muy útiles para trabajar con sucesos contrarios, uniones e intersecciones:</p>
                   <ul class="list-disc list-inside pl-4 space-y-3 mt-2">
                       <li>\\(\\overline{A \\cup B} = \\overline{A} \\cap \\overline{B}\\)<br>El contrario de "\\(A\\) o \\(B\\)" es "ni \\(A\\) ni \\(B\\)" (no \\(A\\) Y no \\(B\\)).</li>
                       <li>\\(\\overline{A \\cap B} = \\overline{A} \\cup \\overline{B}\\)<br>El contrario de "\\(A\\) y \\(B\\)" es "no \\(A\\) o no \\(B\\)" (o ambos no ocurren).</li>
                   </ul>
                    <div class="venn-diagram">
                       <svg viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                           <title>Diagrama de Venn para Ley de Morgan</title>
                           <defs><mask id="maskUnion"><rect x="0" y="0" width="200" height="120" fill="white"/><circle cx="75" cy="60" r="40" fill="black"/><circle cx="125" cy="60" r="40" fill="black"/></mask></defs>
                            <rect x="0" y="0" width="200" height="120" fill="#e0f2fe" stroke="#94a3b8" stroke-width="1"/>
                           <text x="5" y="15" font-size="10" fill="#334155">E</text>
                           <rect x="0" y="0" width="200" height="120" fill="#fca5a5" mask="url(#maskUnion)"/>
                           <circle cx="75" cy="60" r="40" fill="none" stroke="#6366f1" stroke-width="1.5"/><text x="70" y="65" font-size="12" fill="#1e1b4b">A</text>
                           <circle cx="125" cy="60" r="40" fill="none" stroke="#4f46e5" stroke-width="1.5"/><text x="120" y="65" font-size="12" fill="#1e1b4b">B</text>
                           <text x="60" y="110" font-size="9" fill="#b91c1c">Área roja = \\(\\overline{A \\cup B}\\)</text>
                       </svg>
                   </div>
                   <p class="text-sm text-center text-slate-500">Visualización de \\(\\overline{A \\cup B}\\): el área fuera de ambos círculos.</p>
                   <div class="example">
                       <p><strong>Ejemplo:</strong> Sea \\(A\\)= "llueve" y \\(B\\)= "hace viento".<br>
                       \\(\\overline{A \\cup B}\\) significa "No (llueve o hace viento)" = "Ni llueve NI hace viento". Esto es \\(\\overline{A} \\cap \\overline{B}\\).</p>
                   </div>
                   <div class="exercise">
                       <h3>Ejercicio 4.1 (Teoría): Aplicando Leyes de Morgan</h3>
                       <p class="mb-2">Usando las Leyes de Morgan, ¿a qué es equivalente \\(\\overline{\\overline{A} \\cup \\overline{B}}\\)?</p>
                       <input type="text" id="ex_teo_4_1_morgan" class="input-field mb-2" placeholder="Ej: A U B (usa U, I, ~)">
                       <button onclick="checkExTeo4_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_4_1" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "regla-laplace": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-balance-scale mr-2"></i>Casos Favorables / Casos Posibles</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>Si un experimento aleatorio es <strong>regular</strong> (todos sus sucesos elementales son equiprobables), la probabilidad de un suceso \\(A\\) es:</p>
                   <p class="text-center font-semibold my-3 text-xl text-indigo-700">\\[P(A) = \\frac{\\text{Número de casos favorables a } A}{\\text{Número de casos posibles}}\\]</p>
                   <div class="example">
                       <p><strong>Ejemplo:</strong> Sacar una carta de una baraja española (40 cartas). Probabilidad de sacar un Rey.</p>
                       <p>Casos favorables (Reyes) = 4</p>
                       <p>Casos posibles (Total de cartas) = 40</p>
                       <p>\\(P(\\text{Rey}) = \\frac{4}{40} = \\frac{1}{10} = 0.1\\)</p>
                   </div>
                   <div class="exercise">
                       <h3>Ejercicio 5.1 (Teoría): Aplicando Laplace</h3>
                       <p class="mb-2">En una bolsa hay 3 bolas rojas, 2 azules y 5 verdes. Si sacamos una bola al azar, ¿cuál es la probabilidad de que sea azul? (Fracción o decimal).</p>
                       <input type="text" id="ex_teo_5_1_laplace" class="input-field mb-2" placeholder="Ej: 1/5 o 0.2">
                       <button onclick="checkExTeo5_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_5_1" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "probabilidad-condicionada": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-info-circle mr-2"></i>Definición y Fórmula</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>La probabilidad de que ocurra \\(A\\), <strong>sabiendo que ya ha ocurrido \\(B\\)</strong>, se llama probabilidad condicionada \\(P(A|B)\\).</p>
                   <p class="text-center font-semibold my-3 text-xl text-indigo-700">\\[P(A|B) = \\frac{P(A \\cap B)}{P(B)} \\quad (\\text{si } P(B) > 0)\\]</p>
                   <div class="example">
                       <p><strong>Ejemplo:</strong> En una clase hay 10 chicos y 15 chicas. 5 chicos y 10 chicas tienen el pelo castaño. Se elige un estudiante al azar y resulta ser chica (suceso \\(B\\)). ¿Cuál es la probabilidad de que tenga el pelo castaño (suceso \\(A\\)), sabiendo que es chica?</p>
                       <p>\\(P(\\text{Castaño} | \\text{Chica}) = \\frac{10}{15} = \\frac{2}{3}\\).</p>
                   </div>
                    <div class="exercise">
                       <h3>Ejercicio 6.1 (Teoría): Cálculo de \\(P(A|B)\\)</h3>
                       <p class="mb-2">Se lanza un dado. \\(A\\)= "sacar un 3", \\(B\\)= "sacar impar". Calcula \\(P(A|B)\\).</p>
                       <input type="text" id="ex_teo_6_1_condicionada" class="input-field mb-2" placeholder="Fracción o decimal">
                       <button onclick="checkExTeo6_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_6_1" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "sucesos-independientes-dependientes": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-check-double mr-2"></i>Definición y Comprobación</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>Dos sucesos \\(A\\) y \\(B\\) son <strong>independientes</strong> si la ocurrencia de uno no afecta la probabilidad del otro. Es decir, \\(P(A|B) = P(A)\\).</p>
                   <p>Si son independientes, se cumple: <strong class="text-indigo-600">\\(P(A \\cap B) = P(A) \\cdot P(B)\\)</strong>.</p>
                   <p class="mt-1">Si no se cumple, son <strong>dependientes</strong>.</p>
                    <div class="exercise">
                       <h3>Ejercicio 7.1 (Teoría): Identificar Independencia</h3>
                       <p class="mb-2">Se extraen dos cartas de una baraja española (40 cartas) SIN reemplazamiento. Sea A = "la primera carta es un rey" y B = "la segunda carta es un rey". ¿Son A y B sucesos independientes?</p>
                       <select id="ex_teo_7_1_indep" class="input-field mb-2">
                           <option value="">Selecciona</option>
                           <option value="si">Sí, son independientes</option>
                           <option value="no">No, son dependientes</option>
                       </select>
                       <button onclick="checkExTeo7_1()" class="btn btn-primary"><i class="fas fa-check"></i>Comprobar</button>
                       <div id="feedback_ex_teo_7_1" class="feedback"></div>
                   </div>
               </div>
           </div>`,
       "diagramas-arbol": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-route mr-2"></i>Visualizando Experimentos Compuestos</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <p>Los diagramas de árbol son muy útiles para visualizar y calcular probabilidades en experimentos compuestos (varias etapas).</p>
                   <p class="mt-1">En cada rama se escribe la probabilidad del suceso correspondiente. La probabilidad de un camino completo es el producto de las probabilidades de sus ramas.</p>
                   <div class="example">
                       <p><strong>Ejemplo:</strong> Una urna contiene 2 bolas Rojas (R) y 3 Azules (A). Se extraen dos bolas SIN reemplazamiento.</p>
                       <div class="tree-diagram">
                           <div>
                               <span class="tree-branch-label"><strong>1ª Extracción:</strong></span>
                               <div class="tree-node">
                                   <span class="tree-branch-label">\\(P(R_1) = 2/5\\) <i class="fas fa-circle text-red-500 ml-1"></i></span>
                                   <div class="tree-node">
                                       <span class="tree-branch-label">\\(P(R_2|R_1) = 1/4\\) <i class="fas fa-circle text-red-500 ml-1"></i></span>
                                       <span class="tree-path-prob">Camino \\(R_1-R_2\\): \\(P = 2/5 \\cdot 1/4 = 2/20\\)</span>
                                   </div>
                                   <div class="tree-node">
                                       <span class="tree-branch-label">\\(P(A_2|R_1) = 3/4\\) <i class="fas fa-circle text-blue-500 ml-1"></i></span>
                                       <span class="tree-path-prob">Camino \\(R_1-A_2\\): \\(P = 2/5 \\cdot 3/4 = 6/20\\)</span>
                                   </div>
                               </div>
                               <div class="tree-node">
                                   <span class="tree-branch-label">\\(P(A_1) = 3/5\\) <i class="fas fa-circle text-blue-500 ml-1"></i></span>
                                   <div class="tree-node">
                                       <span class="tree-branch-label">\\(P(R_2|A_1) = 2/4\\) <i class="fas fa-circle text-red-500 ml-1"></i></span>
                                       <span class="tree-path-prob">Camino \\(A_1-R_2\\): \\(P = 3/5 \\cdot 2/4 = 6/20\\)</span>
                                   </div>
                                   <div class="tree-node">
                                       <span class="tree-branch-label">\\(P(A_2|A_1) = 2/4\\) <i class="fas fa-circle text-blue-500 ml-1"></i></span>
                                       <span class="tree-path-prob">Camino \\(A_1-A_2\\): \\(P = 3/5 \\cdot 2/4 = 6/20\\)</span>
                                   </div>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>`,
       "glosario": `
           <div class="accordion-item">
               <div class="accordion-header">
                   <span><i class="fas fa-list-ul mr-2"></i>Definiciones Clave</span>
                   <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
               </div>
               <div class="accordion-content">
                   <dl class="space-y-3">
                       <div><dt class="font-semibold text-indigo-600">Experimento Aleatorio:</dt><dd class="ml-4 text-slate-700">Proceso con múltiples resultados posibles, cuyo resultado exacto no se puede predecir.</dd></div>
                       <div><dt class="font-semibold text-indigo-600">Espacio Muestral (\\(E\\)):</dt><dd class="ml-4 text-slate-700">Conjunto de todos los resultados posibles de un experimento aleatorio.</dd></div>
                       <div><dt class="font-semibold text-indigo-600">Suceso:</dt><dd class="ml-4 text-slate-700">Subconjunto del espacio muestral.</dd></div>
                       <div><dt class="font-semibold text-indigo-600">Probabilidad \\(P(A)\\):</dt><dd class="ml-4 text-slate-700">Medida numérica (entre 0 y 1) de la posibilidad de que ocurra un suceso \\(A\\).</dd></div>
                       <div><dt class="font-semibold text-indigo-600">Sucesos Incompatibles:</dt><dd class="ml-4 text-slate-700">No pueden ocurrir simultáneamente (\\(A \\cap B = \\emptyset\\)).</dd></div>
                       <div><dt class="font-semibold text-indigo-600">Probabilidad Condicionada \\(P(A|B)\\):</dt><dd class="ml-4 text-slate-700">Probabilidad de \\(A\\) dado que \\(B\\) ha ocurrido.</dd></div>
                       <div><dt class="font-semibold text-indigo-600">Sucesos Independientes:</dt><dd class="ml-4 text-slate-700">La ocurrencia de uno no afecta la probabilidad del otro. \\(P(A \\cap B) = P(A)P(B)\\).</dd></div>
                   </dl>
               </div>
           </div>`
   };

   // Función para cargar el contenido teórico y activar acordeones
   function loadTeoria() {
       for (const sectionId in teoriaContenido) {
           const sectionElement = document.getElementById(sectionId);
           if (sectionElement) {
               const h2Content = sectionElement.querySelector('h2').outerHTML;
               sectionElement.innerHTML = h2Content + teoriaContenido[sectionId];
           }
       }
       // Re-adjuntar listeners a los acordeones recién creados
       document.querySelectorAll('.concept-card .accordion-header').forEach(header => {
           header.addEventListener('click', () => {
               const content = header.nextElementSibling;
               const icon = header.querySelector('.accordion-icon i');
               header.classList.toggle('active');
               if (content.style.display === 'block') {
                   content.style.display = 'none';
                   if(icon) { icon.classList.remove('fa-chevron-up'); icon.classList.add('fa-chevron-down');}
               } else {
                   content.style.display = 'block';
                    if(icon) { icon.classList.remove('fa-chevron-down'); icon.classList.add('fa-chevron-up');}
               }
           });
       });
       // Asegurar que MathJax procese el nuevo contenido
       if (window.MathJax) {
           MathJax.typesetPromise();
       }
   }
   
   // Cargar contenido teórico al inicio
   document.addEventListener('DOMContentLoaded', loadTeoria);


   let currentExamQuestions = [];
   let userAnswers = {};

   function shuffleArray(array) {
       for (let i = array.length - 1; i > 0; i--) {
           const j = Math.floor(Math.random() * (i + 1));
           [array[i], array[j]] = [array[j], array[i]];
       }
   }

   function startNewExam() {
       shuffleArray(questionBank);
       currentExamQuestions = questionBank.slice(0, 10);
       userAnswers = {};
       
       const examContainer = document.getElementById('examContainer');
       const examResults = document.getElementById('examResults');
       
       examContainer.innerHTML = '<h3 class="text-lg font-semibold mb-3 text-indigo-600">Tu Examen Personalizado:</h3>';
       examContainer.classList.remove('hidden');
       examResults.classList.add('hidden');
       examResults.innerHTML = '';

       currentExamQuestions.forEach((q, index) => {
           const questionDiv = document.createElement('div');
           questionDiv.classList.add('exam-question-item');
           let questionHTML = `<p class="font-semibold mb-2">Pregunta ${index + 1}: ${q.text}</p>`;
           
           if (q.type === 'multiple_choice' || q.type === 'multiple_choice_math' || q.type === 'true_false') {
               q.options.forEach(opt => {
                   questionHTML += `
                       <label class="block my-1 p-2 rounded hover:bg-indigo-50 cursor-pointer">
                           <input type="radio" name="q_${q.id}" value="${opt.value}" class="mr-2 exam-input-radio">
                           ${opt.text}
                       </label>
                   `;
               });
           } else if (q.type === 'short_answer_text' || q.type === 'short_answer_set' || q.type === 'fraction_decimal' || q.type === 'decimal' || q.type === 'decimal_range') {
               questionHTML += `
                   <input type="text" id="ans_${q.id}" class="exam-input" placeholder="Tu respuesta aquí">
               `;
           }
           questionDiv.innerHTML = questionHTML;
           examContainer.appendChild(questionDiv);
       });

       if (window.MathJax) {
           MathJax.typesetPromise([examContainer]).catch(function (err) { console.log('Error MathJax en examen:',err.message); });
       }
       
       document.getElementById('submitExamButton').classList.remove('hidden');
       document.getElementById('startExamButton').innerHTML = '<i class="fas fa-redo"></i>Generar Otro Examen de Práctica';
   }

   function submitExam() {
       currentExamQuestions.forEach(q => {
           if (q.type === 'multiple_choice' || q.type === 'multiple_choice_math' || q.type === 'true_false') {
               const selectedOption = document.querySelector(`input[name="q_${q.id}"]:checked`);
               userAnswers[q.id] = selectedOption ? selectedOption.value : null;
           } else if (q.type === 'short_answer_text' || q.type === 'short_answer_set' || q.type === 'fraction_decimal' || q.type === 'decimal' || q.type === 'decimal_range') {
               const inputElement = document.getElementById(`ans_${q.id}`);
               userAnswers[q.id] = inputElement ? inputElement.value.trim() : "";
           }
       });
       displayExamResults();
   }

   function displayExamResults() {
       const examContainer = document.getElementById('examContainer');
       const examResults = document.getElementById('examResults');
       const submitButton = document.getElementById('submitExamButton');

       // examContainer.classList.add('hidden'); // No ocultar, para poder revisar en contexto
       submitButton.classList.add('hidden');
       examResults.classList.remove('hidden');
       examResults.innerHTML = ''; // Limpiar resultados anteriores

       let score = 0;
       let resultsHTML = '<h3 class="text-xl font-bold mb-4 text-indigo-700">Revisión Detallada:</h3>';

       currentExamQuestions.forEach((q, index) => {
           const userAnswer = userAnswers[q.id];
           let isCorrect = false;
           let correctAnswerDisplay = '';

           if (q.type === 'multiple_choice' || q.type === 'multiple_choice_math') {
               isCorrect = userAnswer === q.correctAnswer;
               correctAnswerDisplay = q.options.find(opt => opt.value === q.correctAnswer)?.text || q.correctAnswer;
           } else if (q.type === 'true_false') {
               isCorrect = (userAnswer === 'true' && q.correctAnswer === true) || (userAnswer === 'false' && q.correctAnswer === false);
               correctAnswerDisplay = q.correctAnswer ? 'Verdadero' : 'Falso';
           } else if (q.type === 'short_answer_text') {
                const normalizedUserAnswer = userAnswer.toLowerCase().replace(/\s+/g, '').replace('{','').replace('}','');
                const normalizedCorrectAnswer = q.correctAnswer.toLowerCase().replace(/\s+/g, '').replace('{','').replace('}','');
                isCorrect = normalizedUserAnswer === normalizedCorrectAnswer || (q.correctAnswer.includes("impar") && normalizedUserAnswer.includes("impar")) || (q.correctAnswer.toUpperCase() === "E" && (normalizedUserAnswer.toUpperCase() === "E" || normalizedUserAnswer.includes("espaciomuestral") || normalizedUserAnswer.includes("sucesoseguro")));
                correctAnswerDisplay = q.correctAnswer;
           } else if (q.type === 'short_answer_set') {
               const userSet = userAnswer.replace(/[{}]/g, '').split(',').map(s => s.trim().toLowerCase()).sort().join(',');
               const correctSet = q.correctAnswer.replace(/[{}]/g, '').split(',').map(s => s.trim().toLowerCase()).sort().join(',');
               isCorrect = userSet === correctSet;
               correctAnswerDisplay = q.correctAnswer;
           } else if (q.type === 'fraction_decimal') {
               isCorrect = areFractionsEquivalent(userAnswer, q.correctAnswer.fraction) || areDecimalsEquivalent(userAnswer, q.correctAnswer.decimal);
               correctAnswerDisplay = `${q.correctAnswer.fraction} (o ${q.correctAnswer.decimal.toFixed(3)})`;
           } else if (q.type === 'decimal') {
                isCorrect = areDecimalsEquivalent(userAnswer, q.correctAnswer.decimal);
                correctAnswerDisplay = q.correctAnswer.decimal.toString();
           } else if (q.type === 'decimal_range') {
               const userNum = parseFloat(userAnswer.replace(',', '.'));
               isCorrect = !isNaN(userNum) && userNum >= q.correctAnswer.min && userNum <= q.correctAnswer.max;
               correctAnswerDisplay = `Entre ${q.correctAnswer.min.toFixed(2)} y ${q.correctAnswer.max.toFixed(2)}`;
           }

           if (isCorrect) {
               score++;
           }

           // Modificar el contenedor de la pregunta original para mostrar feedback
           const questionDivInExam = examContainer.querySelectorAll('.exam-question-item')[index];
           if (questionDivInExam) {
               let feedbackDiv = questionDivInExam.querySelector('.question-feedback');
               if (!feedbackDiv) {
                   feedbackDiv = document.createElement('div');
                   feedbackDiv.classList.add('question-feedback');
                   questionDivInExam.appendChild(feedbackDiv);
               }
               feedbackDiv.className = `question-feedback mt-3 ${isCorrect ? 'correct' : 'incorrect'}`;
               feedbackDiv.innerHTML = `
                   ${isCorrect ? '<i class="fas fa-check-circle mr-1"></i>¡Correcto!' : '<i class="fas fa-times-circle mr-1"></i>Incorrecto.'}
                   ${!isCorrect ? ` La respuesta correcta es: <strong>${correctAnswerDisplay}</strong>.` : ''}
                   <p class="mt-1 text-sm text-slate-700"><em>Explicación: ${q.explanation}</em></p>
               `;
           }
       });
       
       const percentage = (score / currentExamQuestions.length) * 100;
       const summaryHTML = `
           <div class="exam-results-summary">
               <h3 class="text-2xl font-bold mb-2">Tu Puntuación Final</h3>
               <p class="text-4xl font-extrabold ${percentage >= 60 ? 'text-green-600' : 'text-red-600'}">${score} / ${currentExamQuestions.length}</p>
               <p class="text-xl font-semibold mb-3">(${percentage.toFixed(1)}%)</p>
               ${percentage >= 60 ? '<p class="text-green-700"><i class="fas fa-thumbs-up"></i> ¡Buen trabajo!</p>' : '<p class="text-red-700"><i class="fas fa-book-reader"></i> ¡Sigue practicando!</p>'}
           </div>
       `;

       examResults.innerHTML = summaryHTML; // Poner el resumen primero
       // examContainer.innerHTML += resultsHTML; // Añadir revisión detallada después del contenedor de preguntas
       if (window.MathJax) {
           MathJax.typesetPromise([examContainer, examResults]).catch(function (err) { console.log('Error MathJax en resultados:',err.message); });
       }
   }
   
   // Funciones de ayuda para comparación de respuestas
   function areFractionsEquivalent(userStr, correctFractionStr) {
       if (!userStr) return false;
       try {
           const normalizedUserStr = userStr.replace(',', '.');
           let userNum, userDen;
           if (normalizedUserStr.includes('/')) { [userNum, userDen] = normalizedUserStr.split('/').map(Number); }
           else { userNum = parseFloat(normalizedUserStr); userDen = 1; }

           const [corrNum, corrDen] = correctFractionStr.split('/').map(Number);
           if (isNaN(userNum) || isNaN(userDen) || isNaN(corrNum) || isNaN(corrDen) || userDen === 0 || corrDen === 0) return false;
           return Math.abs(userNum / userDen - corrNum / corrDen) < 0.001;
       } catch (e) { return false; }
   }
   function areDecimalsEquivalent(userStr, correctDecimal, tolerance = 0.01) {
       if (!userStr) return false;
       try {
           const normalizedUserStr = userStr.replace(',', '.');
           const userVal = parseFloat(normalizedUserStr);
           return Math.abs(userVal - correctDecimal) < tolerance;
       } catch (e) { return false; }
   }

   // Funciones para los ejercicios de la parte teórica (ejemplos)
   function displayTeoriaFeedback(elementId, message, type) {
       const feedbackEl = document.getElementById(elementId);
       if (feedbackEl) {
           feedbackEl.innerHTML = message;
           feedbackEl.className = 'feedback ' + type;
       }
   }
   function checkExTeo1_1() {
       const answer = document.getElementById('ex_teo_1_1_tipo').value;
       if (answer === 'determinista') {
           displayTeoriaFeedback('feedback_ex_teo_1_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto!', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_1_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto.', 'incorrect');
       }
   }
   function checkExTeo1_2() {
       const userAnswer = document.getElementById('ex_teo_1_2_espacio').value.toLowerCase().replace(/\s+/g, '').split(',').sort().join(',');
       if (userAnswer === "1,2,3,4,5,6") {
           displayTeoriaFeedback('feedback_ex_teo_1_2', '<i class="fas fa-check-circle mr-1"></i>¡Correcto!', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_1_2', '<i class="fas fa-times-circle mr-1"></i>Incorrecto. Debe ser {1,2,3,4,5,6}.', 'incorrect');
       }
   }
   function checkExTeo2_1() {
       const userAnswer = document.getElementById('ex_teo_2_1_contrario').value.toLowerCase().replace(/\s+/g, '').split(',').sort().join(',');
       if (userAnswer === "3,4,5,6") {
           displayTeoriaFeedback('feedback_ex_teo_2_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto!', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_2_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto. Debe ser {3,4,5,6}.', 'incorrect');
       }
   }
    function checkExTeo2_2() {
       const answer = document.getElementById('ex_teo_2_2_compatibilidad').value;
       if (answer === 'compatibles') {
           displayTeoriaFeedback('feedback_ex_teo_2_2', '<i class="fas fa-check-circle mr-1"></i>¡Correcto! Tienen el 2 en común.', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_2_2', '<i class="fas fa-times-circle mr-1"></i>Incorrecto.', 'incorrect');
       }
   }
   function checkExTeo3_1() {
       const userAnswer = document.getElementById('ex_teo_3_1_union').value.toLowerCase().replace(/\s+/g, '').split(',').sort().join(',');
       if (userAnswer === "1,2,4,6") {
           displayTeoriaFeedback('feedback_ex_teo_3_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto!', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_3_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto. Debe ser {1,2,4,6}.', 'incorrect');
       }
   }
   function checkExTeo4_1() {
       const userAnswer = document.getElementById('ex_teo_4_1_morgan').value.toUpperCase().replace(/\s+/g, '').replace('U', 'U').replace('∩', 'I').replace('~', '~');
       if (userAnswer === "AIB" || userAnswer === "A∩B") {
           displayTeoriaFeedback('feedback_ex_teo_4_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto! Es \\(A \\cap B\\)', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_4_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto.', 'incorrect');
       }
   }
   function checkExTeo5_1() {
       const userAnswer = document.getElementById('ex_teo_5_1_laplace').value;
       if (areFractionsEquivalent(userAnswer, "2/10") || areFractionsEquivalent(userAnswer, "1/5") || areDecimalsEquivalent(userAnswer, 0.2)) {
           displayTeoriaFeedback('feedback_ex_teo_5_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto! P(Azul) = 2/10 = 1/5.', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_5_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto.', 'incorrect');
       }
   }
   function checkExTeo6_1() {
       const userAnswer = document.getElementById('ex_teo_6_1_condicionada').value;
        // A="sacar 3"={3}. B="sacar impar"={1,3,5}. A ∩ B = {3}. P(A∩B)=1/6. P(B)=3/6. P(A|B)=(1/6)/(3/6)=1/3.
       if (areFractionsEquivalent(userAnswer, "1/3") || areDecimalsEquivalent(userAnswer, 0.333, 0.001)) {
           displayTeoriaFeedback('feedback_ex_teo_6_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto! \\(P(A|B) = (1/6) / (3/6) = 1/3\\).', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_6_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto.', 'incorrect');
       }
   }
   function checkExTeo7_1() {
       const answer = document.getElementById('ex_teo_7_1_indep').value;
       if (answer === 'no') { // SIN reemplazamiento son dependientes
           displayTeoriaFeedback('feedback_ex_teo_7_1', '<i class="fas fa-check-circle mr-1"></i>¡Correcto! Sin reemplazamiento, la probabilidad de la segunda extracción depende de la primera.', 'correct');
       } else {
           displayTeoriaFeedback('feedback_ex_teo_7_1', '<i class="fas fa-times-circle mr-1"></i>Incorrecto.', 'incorrect');
       }
   }

</script>
</body>
</html>
